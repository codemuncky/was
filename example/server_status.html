<script type="text/javascript">

//Have a look at "npm install mod_statuspage"

// Setup websocket
var ws = new WebSocket('ws://'+window.document.location.host);

// Format a websocket request
function wsRequest(operation,parameters,request,id,event){
  if(!operation) return;
  // Escape user input through stringify function
  var msg={
    "opr":operation
    ,"param":parameters
    ,"receiver_id":id
    ,"event":event
    ,"req":request
  };
  // Send request
  ws.send(JSON.stringify(msg));
}

ws.onopen = function () {
  // request server stats
  wsRequest("serverGet","all","","info");
};

ws.onmessage = function (event) {
  try {
    // Find recipient element an fill it
    var res=JSON.parse(event.data);
    var obj = document.getElementById(res.receiver_id);
    if(res.html){
      obj.outerHTML = res.html;
    }else if(msg.dara)
      obj.innerHTML = res.data;
  } catch (e) {
  }
};

/* ======================================================================== *\
   Debug functions (to be removed)
\* ======================================================================== */
function debug(obj,max_depth) {
  console.log("Debug: ",debug.prints(obj,max_depth));
}  

debug.depth=0; // Keep track og object depth
debug.path=[];

debug.prints = function (obj,max_depth) {
    if(typeof(obj)!='object') return obj;
    var result='';
    var tab='';
    if(!max_depth) max_depth=0;
    for(i=0;i<debug.depth;i++) tab+='--';
    for(var i in obj){
	    // Mozilla bug when accessing document.domConfig
	    if(i=='domConfig') continue;
	    if(obj[i] instanceof Object){
		    result+=tab+'['+i+']=>(object)('+debug.depth+','+max_depth+')\r\n';
		    if(debug.depth<max_depth) {
			    debug.depth++;
			    result+=debug.prints(obj[i],max_depth);
			    debug.depth--;
		    }
	    }else if(obj[i] instanceof Function)
		    result+=tab+'['+i+']=>(Function)\r\n';
	    else{
		    str=''+obj[i];
		    result+=tab+'['+i+']=>'+str.replace(/\</g,'&lt;')+"\r\n";
	    }
    }
    return result;
  }

debug.finds = function (obj,needle,max_depth){
    if(!(obj instanceof Object || obj instanceof Function)) return;
    var result='';
    if(!max_depth) max_depth=0;
    if(debug.depth==0) path=[];
    for(var i in obj){
      if(i==needle){
        for(var p in debug.path)
          result+=debug.path[p]+'.';
      result+=i+'\r\n';
      }
	    // Mozilla bug when accessing document.domConfig
	    if(i=='domConfig') continue;
	    if((obj[i] instanceof Object || obj[i] instanceof Function) && debug.depth<max_depth) {
		    debug.depth++;
        debug.path.push(i);
		    result+=debug.finds(obj[i],needle,max_depth);
		    debug.depth--;
        debug.path.pop();
	    }
    }
    return result;
  }

debug.find = function(obj,needle,max_depth){
  console.log("Debug: ",debug.finds(obj,needle,max_depth));
}

</script>
<style> ._info{width: 400px;margin-left: auto;margin-right: auto;}</style>

<section>
<div id="info"><div>
</section>
